<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaborative Whiteboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
    <div id="loginModal" class="modal" style="display: flex;">
        <div class="modal-content">
            <h2>ğŸ¨ Collaborative Whiteboard</h2>
            <div id="authError" class="error"></div>
            <input type="text" id="username" placeholder="ğŸ‘¤ Username" required>
            <input type="password" id="password" placeholder="ğŸ”’ Password" required>
            <input type="email" id="email" placeholder="ğŸ“§ Email (for registration)" style="display:none;">
            <button id="loginBtn">Sign In</button>
            <button id="registerBtn" style="display:none;">Create Account</button>
            <button id="switchModeBtn" class="secondary">Switch to Register</button>
        </div>
    </div>

    <div id="roomModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">ğŸšª Create or Join Room</h2>
                <button id="logoutBtn" class="secondary" style="padding: 8px 16px; font-size: 12px;" onclick="handleLogout()">Logout</button>
            </div>
            <div style="margin-bottom: 10px; padding: 8px; background: #f0f0f0; border-radius: 6px; font-size: 13px;">
                Logged in as: <strong id="currentUserDisplay"></strong>
            </div>
            <input type="text" id="roomName" placeholder="Enter room name...">
            <button id="createRoomBtn">âœ¨ Create New Room</button>
            <button id="joinRoomBtn" class="secondary">ğŸ” Browse Rooms</button>
            <div id="roomList"></div>
        </div>
    </div>

    <div id="app" style="display:none;">
        <div class="toolbar">
            <div class="tool-group">
                <button id="penTool" class="tool-btn active" data-tool="pen">
                    <span class="tool-icon">âœï¸</span> Pen
                </button>
                <button id="rectangleTool" class="tool-btn" data-tool="rectangle">
                    <span class="tool-icon">â–­</span> Rectangle
                </button>
                <button id="circleTool" class="tool-btn" data-tool="circle">
                    <span class="tool-icon">â—‹</span> Circle
                </button>
                <button id="lineTool" class="tool-btn" data-tool="line">
                    <span class="tool-icon">â”€</span> Line
                </button>
                <button id="textTool" class="tool-btn" data-tool="text">
                    <span class="tool-icon">T</span> Text
                </button>
                <button id="eraserTool" class="tool-btn" data-tool="eraser">
                    <span class="tool-icon">ğŸ§¹</span> Eraser
                </button>
            </div>
            <div class="tool-separator"></div>
            <div class="tool-group">
                <div class="color-picker-wrapper">
                    <label for="colorPicker" style="font-size: 12px; color: var(--text-secondary);">Color</label>
                    <input type="color" id="colorPicker" value="#000000" title="Select color">
                </div>
                <div style="display: flex; align-items: center; gap: 4px;">
                    <label for="lineWidth" style="font-size: 12px; color: var(--text-secondary);">Size</label>
                    <input type="number" id="lineWidth" min="1" max="50" value="2">
                </div>
            </div>
            <div class="tool-separator"></div>
            <div class="tool-group">
                <button id="undoBtn" class="action-btn" title="Undo (Ctrl+Z)">â†¶ Undo</button>
                <button id="redoBtn" class="action-btn" title="Redo (Ctrl+Y)">â†· Redo</button>
                <button id="saveBtn" class="action-btn" title="Save current state" style="background: #4CAF50; color: white; border-color: #4CAF50;" onclick="saveSnapshot()">ğŸ’¾ Save</button>
                <button id="clearBtn" class="action-btn danger" title="Clear canvas">ğŸ—‘ï¸ Clear</button>
            </div>
            <div style="flex: 1;"></div>
            <div class="room-info">
                <span id="roomNameDisplay"></span>
                <span id="userCount"></span>
                <span style="font-size: 12px; color: var(--text-secondary);">User: <strong id="currentUserInToolbar"></strong></span>
                <button id="leaveRoomBtn" class="action-btn danger" onclick="handleLeaveRoom()">Leave Room</button>
                <button id="logoutFromAppBtn" class="action-btn danger" style="font-size: 12px; padding: 6px 12px;" onclick="handleLogoutFromApp()">Logout</button>
            </div>
        </div>

        <div class="main-container">
            <div class="canvas-container">
                <canvas id="whiteboard"></canvas>
                <div id="cursors"></div>
            </div>
            <div class="sidebar">
                <div class="users-panel">
                    <h3>ğŸ‘¥ Active Users</h3>
                    <ul id="usersList"></ul>
                </div>
                <div class="chat-panel">
                    <h3>ğŸ’¬ Chat</h3>
                    <div id="chatMessages"></div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Type a message...">
                        <button id="sendChatBtn">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js?v=2"></script>
    <script>
        // Debug: Check if app.js loaded
        console.log('HTML loaded, checking app.js...');
        setTimeout(() => {
            if (typeof setupEventListeners === 'function') {
                console.log('âœ… app.js loaded successfully');
            } else {
                console.error('âŒ app.js NOT loaded!');
            }
        }, 100);
    </script>
</body>
</html>

